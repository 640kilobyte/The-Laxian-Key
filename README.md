# Отчет по учебному курсу Devops

## Практическая работа №1

Создан бот [The_Laxian_Key_bot](https://t.me/The_Laxian_Key_bot). Для включения - напишите [Red_Lion](https://t.me/red_lion)

Исходный код - [app.py](app.py)

Конфигурация через `.env` (которого нет в репозитории - `.gitignore`)

### Описание решения

1. Логирование.\
Идет в консоль так и в файл.\
Общий уровень логирования настраивается через среды (или `.env`).
2. Справка `/help` и список команд.\
Фактически реализовано одинаково.\
Основной целью было немного удобства при работе.
3. Постраничный вывод.\
Для команд с длинным выводом был сделан pager - функция `more`. \
Вывод явно разделяется на строки, которые также разделяются про превышении размера в символах.\
Строки формируют на страницы по признаку превышения количества строк или количества символов в странице. \
Для вывода используется функция `do_more`, которая показывает следующую страницу и кнопку загрузки следующей страницы. Может быть вызвана с `update` от сообщения так и от `callback`.
4. Удаленный запуск.\
Реализована простая поддержка безопасных аргументов.\
В командную строку они вставляются через `.format`. \
Работа в одном соединении.
5. `/find_email` и `/find_phone`.\
Создан диалог с функциями старта команды и запроса данных.\
Функции команды и запроса - явно отдельные. \
Выбранные регулярные выражения:
    1. простейший поиск email
    2. Анонимные группа для `8` и `+7`, остальная часть номера - простое решение с возможным разделением блоков пробельными и выделением символами.
    > **Hint**
    > Групп две - изначально хотелось сделать все варианты на группах, но в итоге просто сделано подобными блоками `\s*[()-]?\d{3}`
6. `/verify_password`.\
Сделан также диалогом как и предыдущие.\
Проверка считается удачной если все регулярные выражения нашли данные.\
Список спецсимволов был явно взят из ТЗ.
7. `/get_release`, `/get_uname`, `/get_uptime` и прочие простые exec-команды.\
Команды описаны в dict (как и справка).\
Одна функция обслуживает handler команд и по сообщению ищет что конкретно запускать.\
Весь вывод в `more` и MDv2 форматировании как исходный код.\
Удаленный пользователь включен в группу `systemd-journal`
8. `/get_apt_list`.\
При первом запуске дает справку и запускает `apt list`.\
Весь вывод в `more` и MDv2 форматировании как исходный код. \
Пользователь должен ввести уточнение пакета:
    1. Если пакет с таким именем найден - `apt-cache info текст`
    2. Если не найден - `apt list | grep текст`

### Выявленные нюансы

1. Поиск email - есть rfc
2. Поиск номера - не самая лучшая регулярка. Надо учесть коды не только с 3, но и 5 символами (такое есть).
3. Нужно подготовить список зависимостей для `pip install -r`
4. Лучше было разделить нормально на модули.
5. SSH - нужен переход на ключ?
6. Не проверена одновременная работа нескольких пользователей.